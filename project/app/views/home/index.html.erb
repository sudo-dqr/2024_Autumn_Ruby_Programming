<!DOCTYPE html>
<html>
<head>
  <title>Tech Reads</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= stylesheet_link_tag 'application', media: 'all', 'data-turbo-track': 'reload' %>
  <%= stylesheet_link_tag 'home', media: 'all', 'data-turbo-track': 'reload' %>
  <%= javascript_include_tag 'application', 'data-turbo-track': 'reload' %>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
  <header class="bg-dark text-white p-3">
    <div class="container">
      <h1 class="h3 text-center">Welcome to Geek Haven</h1>
      <nav class="nav justify-content-center">
        <%= link_to '首页', root_path, class: 'nav-link text-white' %>
        <% if current_user %>
          <%= link_to '个人资料', user_path(current_user), class: 'nav-link text-white' %>
          <% if current_user.role.name == 'admin' %>
            <%= link_to '管理员面板', admin_dashboard_path, class: 'nav-link text-white' %>
          <% end %>
          <%= button_to '登出', logout_path, method: :delete, class: 'nav-link text-white' %>
        <% else %>
          <%= link_to '登录', login_path, class: 'nav-link text-white' %>
          <%= link_to '注册', new_user_path, class: 'nav-link text-white' %>
        <% end %>
      </nav>
    </div>
  </header>

  <div class="container mt-4">
    <h2 class="mb-4">我们的产品</h2>
    <div class="row">
      <% @products.each do |product| %>
        <div class="col-md-4 mb-4">
          <div class="card h-100">
            <%= image_tag product.image_url, alt: product.name, class: 'card-img-top' if product.image_url.present? %>
            <div class="card-body">
              <h5 class="card-title"><%= product.name %></h5>
              <p class="card-text"><%= product.description %></p>
              <p class="card-text text-success">价格: <%= number_to_currency(product.price) %></p>
              <div class="d-grid gap-2">
                <%= link_to '查看详情', product_path(product), class: 'btn btn-primary' %>
                <%= link_to '添加到购物车', cart_items_path(cart_item: { product_id: product.id, quantity: 1 }), method: :post, class: 'btn btn-success' %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</body>
</html>